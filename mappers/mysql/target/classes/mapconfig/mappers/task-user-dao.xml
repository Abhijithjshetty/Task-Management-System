<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.taskmanagement.mappers.mysql.TaskUserDao">


    <insert id="insert" parameterType="com.taskmanagement.models.TaskUser"
            useGeneratedKeys="true" keyProperty="id">
        INSERT INTO SUSHIKHA_USER
        (SUSHIKHA_USER_ID, NAME, EMAIL, PHONE, DOB, STATUS, CITY, PINCODE, PHONE_VERIFIED, EMAIL_VERIFIED, CREATED_ON)
        VALUES(
        #{sushikhaUser.sushikhaUserId},
        #{sushikhaUser.name},
        #{sushikhaUser.email},
        #{sushikhaUser.phone},
        #{sushikhaUser.dob},
        #{sushikhaUser.status},
        #{sushikhaUser.city},
        #{sushikhaUser.pincode},
        #{sushikhaUser.phoneVerified},
        #{sushikhaUser.emailVerified},
        #{sushikhaUser.createdOn}
        )
    </insert>
    <select id="selectUserByEmail" resultType="com.taskmanagement.models.TaskUser" parameterType="java.lang.String">
        SELECT * FROM SUSHIKHA_USER WHERE EMAIL = #{email}
    </select>

    <select id="selectUserByPhone" resultType="com.taskmanagement.models.TaskUser" parameterType="java.lang.String">
        SELECT * FROM SUSHIKHA_USER WHERE PHONE = #{phone}
    </select>

    <select id="getUserByRegistrationId" resultType="com.taskmanagement.models.TaskUser" parameterType="java.lang.String">
        SELECT * FROM SUSHIKHA_USER WHERE SUSHIKHA_USER_ID = #{sushikhaUserId}
    </select>

    <update id="update" parameterType="com.taskmanagement.models.TaskUser">
        UPDATE SUSHIKHA_USER
        <set>
            <if test="sushikhaUser.email != null">
                EMAIL = #{sushikhaUser.email},
            </if>
            <if test="sushikhaUser.phone != null">
                PHONE = #{sushikhaUser.phone},
            </if>
            <if test="sushikhaUser.profilePic != null">
                PROFILE_PIC = #{sushikhaUser.profilePic},
            </if>
            <if test="sushikhaUser.emailVerified != null">
                EMAIL_VERIFIED = #{sushikhaUser.emailVerified},
            </if>
            <if test="sushikhaUser.phoneVerified != null">
                PHONE_VERIFIED = #{sushikhaUser.phoneVerified},
            </if>
            <if test="sushikhaUser.status != null">
                STATUS = #{sushikhaUser.status},
            </if>
            <if test="sushikhaUser.city != null">
                CITY = #{sushikhaUser.city},
            </if>
            <if test="sushikhaUser.pincode != null">
                PINCODE = #{sushikhaUser.pincode},
            </if>
            <if test="sushikhaUser.dob != null">
                DOB = #{sushikhaUser.dob},
            </if>
            UPDATED_ON = #{sushikhaUser.updatedOn}
        </set>
        WHERE SUSHIKHA_USER_ID = #{sushikhaUser.sushikhaUserId}
    </update>


    <select id="getProfilePicByUserId" resultType="Byte[]" parameterType="java.lang.String">
        SELECT PROFILE_PIC FROM SUSHIKHA_USER WHERE SUSHIKHA_USER_ID = #{sushikhaUserId}
    </select>

    <select id="selectTotalCount" resultType="java.lang.Long">
        SELECT COUNT(*) FROM SUSHIKHA_USER WHERE 1=1
        <if test="sushikhaUserId != null">
            AND SUSHIKHA_USER_ID = #{sushikhaUserId}
        </if>
    </select>

    <select id="selectRecordsInRange"  resultType="com.taskmanagement.models.TaskUser">
        SELECT ID, SUSHIKHA_USER_ID, NAME,  CITY, PINCODE, EMAIL, PHONE, STATUS, CREATED_ON, DOB, PHONE_VERIFIED, EMAIL_VERIFIED, UPDATED_ON
        FROM SUSHIKHA_USER WHERE 1=1
        <if test="sushikhaUserId != null">
            AND SUSHIKHA_USER_ID = #{sushikhaUserId}
        </if>
        <if test="pageSize != null and calculatedOffset != null">
            LIMIT #{pageSize} OFFSET #{calculatedOffset}
        </if>
    </select>

    <update id="updateUserStatus" parameterType="com.taskmanagement.models.TaskUser">
        UPDATE SUSHIKHA_USER
        <set>
            <if test="sushikhaUser.emailVerified != null">
                EMAIL_VERIFIED = #{sushikhaUser.emailVerified},
            </if>
            <if test="sushikhaUser.phoneVerified != null">
                PHONE_VERIFIED = #{sushikhaUser.phoneVerified},
            </if>
            <if test="sushikhaUser.status != null">
                STATUS = #{sushikhaUser.status},
            </if>
            UPDATED_ON = #{sushikhaUser.updatedOn}
        </set>
        WHERE SUSHIKHA_USER_ID = #{sushikhaUser.sushikhaUserId}

    </update>

    <select id="selectUserIdByPhone" parameterType="java.lang.String"
            resultType="java.lang.String">
        SELECT SUSHIKHA_USER_ID FROM SUSHIKHA_USER
        WHERE PHONE = #{phone}
    </select>

</mapper>
